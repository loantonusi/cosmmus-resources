\begin{algorithm}[t!]
\small

\begin{distribalgo}[1]

%\vspace{1.0mm}

\INDENT{\colorbox{\coloralgo}{To issue a command $C$, the client does:}}

\vspace{1.0mm}
\INDENT{\textbf{do}}
	\STATE \amcast$($oracle, $consult(C))$
	\COMMENT{atomic multicast to...}
	\STATE wait for $prophecy$
	\COMMENT{...retrieve involved partitions}
	\IF[in this case...]{$prophecy \in \{ok, nok\}$}
		\STATE $reply \leftarrow prophecy$
		\COMMENT{...there's nothing to execute}
	\ELSE[in this case, $prophecy$ is $(dests,sync)$]
		\IF[if did move:]{$C$ is $access(\omega)$ and $|sync| > 1$}
			\FOR[wait for partitions...]{each $\ppm \in sync$}
				\STATE wait for $reply$ from a server in $\ppm$
				\COMMENT{...in move}
			\ENDFOR
		\ENDIF
		\STATE \amcast$(dests, C)$
		\COMMENT{atomic multicast command}
		\FOR{each $\ppm \in dests$}
			\STATE wait for $reply$ from a server in $\ppm$
		\ENDFOR
	\ENDIF
\ENDINDENT
\STATE{\textbf{while} $reply = retry$} %// \textit{after many retries, fall back to \ssmr}}
\STATE return $reply$ to the application
\ENDINDENT

\caption{Client}
\label{alg:client_proxy}
\end{distribalgo}
\end{algorithm}